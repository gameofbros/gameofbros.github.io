"use strict";paper,paper.install(window);var SQRT_3=Math.pow(3,.5),triangle,D,mousePos,position,count=50;window.onload=function(){paper.setup("triangle-lost-in-space"),D=Math.max(paper.view.getSize().width,paper.view.getSize().height),mousePos=paper.view.center.add([view.bounds.width/3,100]),position=paper.view.center;var e=new Path.Rectangle(view.bounds);e.fillColor="#004469",buildStars(),triangle=new Triangle(50),paper.view.draw(),paper.view.onFrame=function(e){position=position.add(mousePos.subtract(position).divide(10));var t=view.center.subtract(position).divide(10);moveStars(t.multiply(3)),triangle.update()}},window.onresize=function(){project.clear(),D=Math.max(paper.view.getSize().width,paper.view.getSize().height);var e=new Path.Rectangle(view.bounds);e.fillColor="#004469",buildStars(),triangle.build(50)};var random=function(e,t){return Math.round(Math.random()*(t-e)+e)},map=function(e,t,i,n,o){return(e-t)/(i-t)*(o-n)+n},Triangle=function(e){this.build(e)};Triangle.prototype.build=function(e){var t=[new paper.Point(0,-e/SQRT_3),new paper.Point(-e/2,.5*e/SQRT_3),new paper.Point(e/2,.5*e/SQRT_3)];this.flameSize=e/SQRT_3;var i=[new paper.Point(0,this.flameSize),new paper.Point(-e/3,.4*e/SQRT_3),new paper.Point(e/3,.4*e/SQRT_3)];this.flame=new Path({segments:i,closed:!0,fillColor:"#FCE589"}),this.ship=new Path({segments:t,closed:!0,fillColor:"#FF7885"}),this.group=new Group({children:[this.flame,this.ship],position:view.center})},Triangle.prototype.update=function(){this.flame.segments[0].point.x=random(this.flame.segments[1].point.x,this.flame.segments[2].point.x);var e=mousePos.subtract(paper.view.center).length,t=mousePos.subtract(paper.view.center).angle,i=map(e,0,D/2,10,30);this.flame.segments[0].point=paper.view.center.subtract(new Point({length:map(e,0,D/2,2*this.flameSize/3,this.flameSize),angle:random(t-i,t+i)}))},Triangle.prototype.rotate=function(){var e=paper.view.center.subtract(mousePos).angle-paper.view.center.subtract(this.ship.segments[0].point).angle;this.group.rotate(e,paper.view.center)},window.onmousemove=function(e){mousePos.x=e.x,mousePos.y=e.y,triangle.rotate()};var buildStars=function(){for(var e=new Path.Circle({center:[0,0],radius:5,fillColor:"white",strokeColor:"white"}),t=new Symbol(e),i=0;count>i;i++){var n=Point.random().multiply(paper.view.size),o=t.place(n);o.scale(i/count+.01),o.data={vector:new Point({angle:360*Math.random(),length:i/count*Math.random()/5})}}new Point({angle:45,length:0})},keepInView=function(e){var t=e.position,i=paper.view.bounds;if(!t.isInside(i)){var n=e.bounds;t.x>i.width+5&&(t.x=-e.bounds.width),t.x<-n.width-5&&(t.x=i.width),t.y>i.height+5&&(t.y=-n.height),t.y<-n.height-5&&(t.y=i.height)}},moveStars=function(e){for(var t=project.activeLayer,i=1;count+1>i;i++){var n=t.children[i],o=n.bounds.size,a=e.length/10*o.width/10;n.position=n.position.add(e.normalize(a).add(n.data.vector)),keepInView(n)}};